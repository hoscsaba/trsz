function [csovek,cpnevsor,csom]=olvas5r(fnev,debug)%...adatfile olvasasa..............%global nev nag agnev cpele cpveg d del L Ec Ef opsz m%global cpnevsor grav=9.806;if debug>1  fprintf('\n\n****************************************************');  fprintf('\n*          RUGALMAS CSÖVEK OLVASÁSA                *');  fprintf('\n****************************************************\n\n');  endif debug==1  fprintf('Rugalmas csövek olvasása (%s.mdt)\t\t\t\t',fnev);endif debug>1  fprintf('\n  Feladat neve: %s',fnev);  fprintf('\n  Adatfile megnyitása...');end  %...file-nev es kiterjesztes...kiterjeszt='.dat';fnevdat=strcat(fnev,kiterjeszt);if debug>1  fprintf('  OK');  fprintf('\n  Adatok olvasása...');end[be]=textread(fnevdat,'%s','delimiter',',');if debug==1,   fprintf('OK'); end%...k: cso-index...j: osztaspont index...jc: csomopont index...%...az elso negy adat ....nev=char(be(1));              %....adatallomany nevenag=str2num(char(be(2)));      %....rug. csovek szama..   %...a tobbi adat.....k=0;elem1=13;if debug>1  fprintf('\n\n   agnev     cpele     cpveg    d        del      L           E     opsz   m         p      ro      Ef');endfor i=3:elem1:nag*elem1    k=k+1;    agnev{k}=char(be(i));                  %...agnev...    cpele{k}=char(be(i+1));                %....cpnev ele......     cpveg{k}=char(be(i+2));                %....cpnev veg..    d(k)=str2num(char(be(i+3)));           %...atmero...m    lam(k)=str2num(char(be(i+4)));         %... lambda    del(k)=str2num(char(be(i+5)));         %...falvastagsag...m    L(k)=str2num(char(be(i+6)));           %...ag- hossz...m    Ec(k)=str2num(char(be(i+7)));           %...cso-rug.mod....N/m2    opsz(k)=str2num(char(be(i+8)));        %....szakasz-szam......    m(k)=str2num(char(be(i+9)));           %....tomegaram....m3/s...    pe(k)=str2num(char(be(i+10)));         %...nyomas N/m2 a cso elejen...    ro(k)=str2num(char(be(i+11)));         %...suruseg kg/m3...    Ef(k)=str2num(char(be(i+12)));         %...foly-rug.mod....N/m2        if debug>1      fprintf('\n%8s  %8s  %8s  %6.4f   %6.4f   %6.2f   %6.2e  %3i  %6.2f  %8.0f  %4.1f  %6.2e',char(agnev{k}),char(cpele{k}),char(cpveg{k}),d(k),del(k),L(k),Ec(k),opsz(k),m(k),pe(k),ro(k),Ef(k)); %pause;        endend;%...osztasponti adatok......................for k=1:nag    Ds=L(k)/(opsz(k)-1);    A=d(k)^2*pi/4;    seb(k)=m(k)/ro(k)/A;    Dpv(k)=lam(k)*Ds/d(k)*ro(k)/2*seb(k)*abs(seb(k));endiveg=i+elem1-1;for k=1:nag    ikezd=iveg+1;    iveg=ikezd+opsz(k)-1;    for i=ikezd:iveg        j=i-ikezd+1;        h(k,j)=str2num(char(be(i)));        if j==1            p(k,j)=pe(k);        else            p(k,j)=p(k,j-1)-ro(k)*grav*(h(k,j)-h(k,j-1))-Dpv(k);	            end;    endendif debug>2  fprintf('\n\n  k     j     h           p        v');  for k=1:nag     for j=1:opsz(k)          fprintf('\n %3i  %3i  %7.3f  %10.0f  %6.3f',k,j,h(k,j),p(k,j),seb(k));        end    endend%....cpnevsor osszeallitas.......cpnevsor{1}=cpele{1};jc=1;for k=1:nag    jel='n';    for i=1:jc        if strcmp(cpnevsor{i},cpele{k})            jel='i';        end;    end;    if strcmp(jel,'n')        jc=jc+1;        cpnevsor{jc}=cpele{k};    end    jel='n';    for i=1:jc        if strcmp(cpnevsor{i},cpveg{k})            jel='i';        end    end    if strcmp(jel,'n')        jc=jc+1;        cpnevsor{jc}=cpveg{k};    endendncp=jc;  %...csomopontszam...if debug>1  fprintf('\n\n  jc       cpnev');  for jc=1:ncp    fprintf('\n %3i  %8s',jc,char(cpnevsor{jc}))  endend%...rangszam kiszamitasa es cpsor ellenorzese............. rang=zeros(1,ncp);for jc=1:ncp     mar_volt=0;     for k=1:nag         if strcmp(cpnevsor{jc},cpele{k}) |  strcmp(cpnevsor{jc},cpveg{k})               rang(jc)=rang(jc)+1;             mar_volt=1;         end;     end     if mar_volt==0         fprintf('\n cp hiba %s',cpnevsor{jc} );     end end %rang r_max=max(rang);%r_max%...csom osszeallitas... csom=zeros(ncp,r_max); for i=1:ncp     j=0;     for k=1:nag         if strcmp(cpnevsor{i},cpele{k})            j=j+1;             csom(i,j)=-k;         end         if strcmp(cpnevsor{i},cpveg{k})            j=j+1;             csom(i,j)=k;         end     end end           %csom%...itt a csom vege.......if debug>0, fprintf('\n'); end% Es itt akkor létrehozzuk a csovetfor k=1:nag  eok=0; vok=0;  for i=1:length(csom(:,1))    for j=1:length(csom(1,:))      if csom(i,j)==-k	cpele_szam=i; eok=1;      end      if csom(i,j)==k	cpveg_szam=i; vok=1;      end    end  end           if eok==0, error('Nem találom az elején a csomópontot.'); end  if vok==0, error('Nem találom a végén a csomópontot.'); end    if debug>1, fprintf('\n%2d./%2d csõ létrehozása... ',k,nag); end       csovek{k}=cso(agnev{k},cpele_szam,cpveg_szam,d(k),lam(k),del(k),L(k),Ec(k),opsz(k),ro(k),Ef(k),seb(k),p(k,1:opsz(k)),h(k,1:opsz(k)));  if debug>1, fprintf(' OK'); end  endif debug>1  pause;end