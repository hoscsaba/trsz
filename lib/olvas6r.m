function [csovek,cpnevsor,csom,amoba]=olvas6r(fnev,debug)%...adatfile olvasasa..............%global nev nag agnev cpele cpveg d del L Ec Ef opsz m%global cpnevsor grav=9.806;if debug==1  fprintf('\n\nRugalmas cs�vek olvas�sa...')endif debug>1  fprintf('\n\n****************************************************');  fprintf('\n*          RUGALMAS CSOVEK OLVASASA                *');  fprintf('\n****************************************************\n\n');  endif debug>0  fprintf('\n  Feladat neve: %s',fnev);  fprintf('\n  Adatfile megnyit�sa...');end  %...file-nev es kiterjesztes...%kiterjeszt='.dat';kiterjeszt='.rdt';fnevdat=strcat(fnev,kiterjeszt);if debug>0  fprintf('\n  Adatok olvasasa...');end[be]=textread(fnevdat,'%s','delimiter',',');%...k: cso-index...j: osztaspont index...jc: csomopont index...%...az elso negy adat ....nev=char(be(1));              %....adatallomany nevenag=str2num(char(be(2)));      %....rug. csovek szama..   %...a tobbi adat.....k=0;elem1=13;if debug>1  fprintf('\n\n           agnev     cp_1  ->  cp_2    d[m]     del[m]   L[m]     E[Pa]    opsz  m0[kg/s]  p0[bar]  ro[kg/m^3]   Ef[Pa]   a[m/s]   dt[s]');  fprintf('\n-----------------------------------------------------------------------------------------------------------------------------------------------');endfor i=3:elem1:nag*elem1    k=k+1;    agnev{k}=char(be(i));                  %...agnev...    cpele{k}=char(be(i+1));                %....cpnev ele......     cpveg{k}=char(be(i+2));                %....cpnev veg..    d(k)=str2num(char(be(i+3)));           %...atmero...m    lam(k)=str2num(char(be(i+4)));         %... lambda    del(k)=str2num(char(be(i+5)));         %...falvastagsag...m    L(k)=str2num(char(be(i+6)));           %...ag- hossz...m    Ec(k)=str2num(char(be(i+7)));           %...cso-rug.mod....N/m2    opsz(k)=str2num(char(be(i+8)));        %....szakasz-szam......    m(k)=str2num(char(be(i+9)));           %....tomegaram....m3/s...    pe(k)=str2num(char(be(i+10)));         %...nyomas N/m2 a cso elejen...    ro(k)=str2num(char(be(i+11)));         %...suruseg kg/m3...    Ef(k)=str2num(char(be(i+12)));         %...foly-rug.mod....N/m2        Er=(1/Ef(k)+d(k)/del(k)/Ec(k))^(-1);    aa=sqrt(Er/ro(k));    dx=L(k)/(opsz(k)-1);    dt=dx/aa;        if debug>1      fprintf('\n %2d/%2d  %8s  %8s  %8s  %6.4f   %6.4f   %6.1f   %6.2e  %3d   %6.2f    %5.2f      %4.1f    %6.2e  %7.2f  %3.3f',k,nag,char(agnev{k}),char(cpele{k}),char(cpveg{k}),d(k),del(k),L(k),Ec(k),opsz(k),m(k),pe(k)/1e5,ro(k),Ef(k),aa,dt); %pause;        endend;%...osztasponti adatok......................for k=1:nag    Ds=L(k)/(opsz(k)-1);    A=d(k)^2*pi/4;    seb(k)=m(k)/ro(k)/A;    Dpv(k)=lam(k)*Ds/d(k)*ro(k)/2*seb(k)*abs(seb(k));endiveg=i+elem1-1;for k=1:nag  ikezd=iveg+1;  iveg=ikezd+opsz(k)-1;%  fprintf('\n --> %d. cs� : i=%d  opsz=%d ikezd=%d  iveg=%d',k,i,opsz(k),ikezd,iveg);  for i=ikezd:iveg    j=i-ikezd+1;    h(k,j)=str2num(char(be(i)));    if j==1,  p(k,j)=pe(k);    else,     p(k,j)=p(k,j-1)-ro(k)*grav*(h(k,j)-h(k,j-1))-Dpv(k); end  end%  i=i+opsz(k);  i=iveg;endi=i+1;if debug>2  fprintf('\n\n    k     j     h           p        v');  fprintf('\n  ------------------------------------------');  for k=1:nag     for j=1:opsz(k)          fprintf('\n   %3i  %3i  %7.3f  %10.0f  %6.3f',k,j,h(k,j),p(k,j),seb(k));        end     fprintf('\n  ------------------------------------------');  endend%....am�ba csom�pontok adatai..............% Magass�got �s fogyaszt�st olvasunk ...%i=i-2; % csak azt meg ne k�rdezd, mi�rt, de �gy j�...if debug>0    fprintf('\n\n Am�ba csom�pontok:\n');    fprintf('\n       n�v   h[m]   fogy.[kg/m^3]');       fprintf('\n   ---------------------------------');endif length(be)>i  j=1;  while (i+2<=length(be))    amoba{j}{1}=char(be(i));    amoba{j}{3}=str2num(char(be(i+1)));    amoba{j}{2}=str2num(char(be(i+2)));    if debug>0, fprintf('\n  %8s   %6.2f  %6.2f',amoba{j}{1},amoba{j}{3},amoba{j}{2}); end    j=j+1; i=i+3;  endelse  amoba=[];%  warning('Nincs am�ba csom�pont... Ne csod�lkozz, ha kiakadok... <olvas6r.m>')end%....cpnevsor osszeallitas................cpnevsor{1}=cpele{1};jc=1;for k=1:nag    jel='n';    for i=1:jc        if strcmp(cpnevsor{i},cpele{k})            jel='i';        end;    end;    if strcmp(jel,'n')        jc=jc+1;        cpnevsor{jc}=cpele{k};    end    jel='n';    for i=1:jc        if strcmp(cpnevsor{i},cpveg{k})            jel='i';        end    end    if strcmp(jel,'n')        jc=jc+1;        cpnevsor{jc}=cpveg{k};    endendncp=jc;  %...csomopontszam...if debug>2  fprintf('\n\n  jc       cpnev');  for jc=1:ncp    fprintf('\n %3i  %8s',jc,char(cpnevsor{jc}))  endend%...rangszam kiszamitasa es cpsor ellenorzese............. rang=zeros(1,ncp);for jc=1:ncp     mar_volt=0;     for k=1:nag         if strcmp(cpnevsor{jc},cpele{k}) |  strcmp(cpnevsor{jc},cpveg{k})               rang(jc)=rang(jc)+1;             mar_volt=1;         end;     end     if mar_volt==0         fprintf('\n cp hiba %s',cpnevsor{jc} );     end end %rang r_max=max(rang);%r_max%...csom osszeallitas... csom=zeros(ncp,r_max); for i=1:ncp     j=0;     for k=1:nag         if strcmp(cpnevsor{i},cpele{k})            j=j+1;             csom(i,j)=-k;         end         if strcmp(cpnevsor{i},cpveg{k})            j=j+1;             csom(i,j)=k;         end     end end           %csom%...itt a csom vege.......if debug>0, fprintf('\n'); end% Es itt akkor l�trehozzuk a csovetfor k=1:nag  eok=0; vok=0;  for i=1:length(csom(:,1))    for j=1:length(csom(1,:))      if csom(i,j)==-k	cpele_szam=i; eok=1;      end      if csom(i,j)==k	cpveg_szam=i; vok=1;      end    end  end           if eok==0, error('Nem tal�lom az elej�n a csom�pontot.'); end  if vok==0, error('Nem tal�lom a v�g�n a csom�pontot.'); end    if debug>1, fprintf('\n%2d./%2d cs� l�trehoz�sa... ',k,nag); end     csovek{k}=cso(agnev{k},cpele_szam,cpveg_szam,d(k),lam(k),del(k),L(k),Ec(k),opsz(k),ro(k),Ef(k),seb(k),p(k,1:opsz(k)),h(k,1:opsz(k)));  if debug>1, fprintf(' OK'); end  endif debug>1  pause;end%fprintf('\nsdfkhaslfkj-->%d',length(amoba))%pause